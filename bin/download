#!/bin/bash

set -euo pipefail
set -x

die() {
  printf >&2 '%s\n' "$*"
  exit 1
}

aoc_download() {
  aoc download -y 2023 -d "$@"
}

main() {
  local day=$1
  case $day in
    day[01][0-9]) : ;;
    *) die "Usage: download dayNN" ;;
  esac

  if test -s "$day/input.txt"; then
    return
  fi

  mkdir -p "$day"
  cd "$day"

  local daynum=${day#day}
  daynum=${daynum#0}

  if ! aoc_download "$daynum"; then
    cd ..
    rmdir "$day" || :
    exit 1
  fi
  echo 0 | aoc_download "$daynum" -e
  mv problem.md README.md
  mv example.txt example1.txt
  ln -s example1.txt example2.txt

  if ! test -s "$day.py"; then
    sed -e "s|day/0|day/$daynum|" <../day00/day00.py >"$day.py"
    chmod +x "$day.py"
  fi
}

main "$@"
